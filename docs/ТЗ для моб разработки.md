# Техническое задание для AI агента: Мобильное приложение "Jadidlar"

## 1. Общая информация о проекте

### 1.1 Описание проекта
Мобильное приложение "Jadidlar" — электронная библиотека, посвященная джадидам — представителям прогрессивного просветительского и общественно-политического движения, возникшего в конце XIX – начале XX веков среди мусульман России, особенно в Средней Азии.

### 1.2 Технический стек
- **Платформа**: Android
- **Язык программирования**: Kotlin
- **UI**: XML layouts (все макеты уже написаны)
- **Backend**: Firebase (Firestore, Storage, Analytics)
- **Дополнительные библиотеки**:
  - PDF Viewer: https://github.com/afreakyelf/Pdf-Viewer
  - Glide для загрузки изображений
  - Navigation Component для навигации

### 1.3 Целевая платформа
- Минимальная версия Android: API 24 (Android 7.0)
- Целевая версия: API 34 (Android 14)

---

## 2. Архитектура приложения

### 2.1 Паттерн проектирования
- **MVVM** (Model-View-ViewModel)
- Repository pattern для работы с данными
- Clean Architecture принципы

### 2.2 Структура пакетов
```
com.example.jadidlar/
├── data/
│   ├── models/          # Data классы
│   ├── repository/      # Репозитории
│   └── firebase/        # Firebase утилиты
├── ui/
│   ├── main/           # Главный экран
│   ├── jadidlar/       # Экраны джадидов
│   ├── books/          # Экраны литературы
│   ├── tests/          # Экраны тестов
│   └── reader/         # Экран чтения
├── viewmodels/         # ViewModel классы
├── utils/              # Утилиты
└── adapters/           # RecyclerView адаптеры
```

---

## 3. Структура базы данных Firebase

### 3.1 Коллекция "jadids" (Джадиды)
```json
{
  "id": "string",
  "name": "string",
  "nameUz": "string",
  "birthYear": "int",
  "deathYear": "int",
  "shortDescription": "string",
  "fullDescription": "string",
  "imageUrl": "string",
  "orderIndex": "int"
}
```

### 3.2 Коллекция "books" (Литература)
```json
{
  "id": "string",
  "title": "string",
  "authorId": "string",
  "authorName": "string",
  "publishYear": "int",
  "description": "string",
  "coverImageUrl": "string",
  "pdfUrl": "string",
  "rating": "int",
  "isFavorite": "boolean",
  "orderIndex": "int"
}
```

### 3.3 Коллекция "tests" (Тесты)
```json
{
  "id": "string",
  "title": "string",
  "description": "string",
  "questionCount": "int",
  "timeLimit": "int",
  "questions": [
    {
      "id": "string",
      "questionText": "string",
      "answers": ["string", "string", "string", "string"],
      "correctAnswerIndex": "int"
    }
  ]
}
```

### 3.4 Коллекция "test_results" (Результаты тестов)
```json
{
  "id": "string",
  "testId": "string",
  "userId": "string",
  "score": "int",
  "totalQuestions": "int",
  "timeSpent": "long",
  "completedAt": "timestamp",
  "answers": [
    {
      "questionId": "string",
      "selectedAnswerIndex": "int",
      "isCorrect": "boolean"
    }
  ]
}
```

---

## 4. Требования к реализации

## МОДУЛЬ 1: Настройка проекта и базовая структура

### Задачи
1. Настроить Gradle dependencies для всех необходимых библиотек
2. Интегрировать Firebase (Firestore, Storage, Analytics)
3. Создать структуру пакетов согласно архитектуре
4. Настроить Navigation Component с nav_graph.xml
5. Создать все Data классы (Jadid, Book, Test, Question, TestResult)
6. Настроить ViewBinding
7. Создать базовые Repository классы для работы с Firebase

### Технические требования
- Включить ViewBinding в build.gradle
- Настроить Firebase согласно документации
- Использовать Kotlin Coroutines для асинхронных операций
- Создать singleton Firebase instance

---

## МОДУЛЬ 2: Bottom Navigation и главный экран

### 2.1 MainActivity
**Требования:**
- Использовать готовый layout `activity_main.xml`
- Настроить BottomNavigationView с тремя пунктами меню
- Интегрировать NavHostFragment для навигации
- Связать BottomNavigationView с Navigation Component

### 2.2 MainFragment (Главное меню)
**Layout:** `fragment_main.xml` (готов)

**Функционал:**
- Загрузить список джадидов из Firebase (первые 10, сортировка по orderIndex)
- Отобразить в горизонтальном RecyclerView
- Загрузить топ литературу (сортировка по rating DESC, первые 10)
- Отобразить в вертикальном RecyclerView
- При клике на заголовок "Jadidlar" → навигация к JadidListFragment
- При клике на джадида → навигация к JadidDetailFragment с передачей ID
- При клике на книгу → навигация к BookDetailFragment с передачей ID
- Реализовать состояния: loading, success, error

**ViewModel:**
- MainViewModel с LiveData для jadids и topBooks
- Методы: loadData(), navigateToJadid(id), navigateToBook(id)

### 2.3 Адаптеры

**JadidHorizontalAdapter:**
- Отображение круглых изображений джадидов
- Имя под изображением
- Обработка кликов с callback

**BookVerticalAdapter:**
- Обложка книги слева
- Название, автор, краткое описание справа
- Рейтинг с иконкой
- Обработка кликов с callback

---

## МОДУЛЬ 3: Экраны Джадидов

### 3.1 JadidListFragment
**Layout:** `fragment_jadid_list.xml` (готов)

**Функционал:**
- Загрузить все записи джадидов из Firebase
- Отобразить в RecyclerView с GridLayoutManager (3 колонки)
- При клике → навигация к JadidDetailFragment
- Обработка состояний: loading, success, error

**Adapter:**
- JadidGridAdapter для отображения сетки с фото и именами

**ViewModel:**
- JadidListViewModel с методом loadAllJadids()

### 3.2 JadidDetailFragment
**Layout:** `fragment_jadid_detail.xml` (готов)

**Функционал:**
- Получить ID джадида из arguments
- Загрузить данные джадида из Firebase
- Отобразить: фото, имя, годы жизни, короткое описание
- Реализовать кнопку "Подробнее" для раскрытия полного описания
- Загрузить книги автора (фильтр по authorId)
- Отобразить книги в вертикальном RecyclerView
- При клике на книгу → навигация к BookDetailFragment
- Реализовать кнопку "Назад" в Toolbar
- Реализовать кнопку "Избранное" (иконка сердца, toggle состояние)
- Реализовать кнопку "Поделиться" (Share Intent)

**ViewModel:**
- JadidDetailViewModel с методами:
  - loadJadid(jadidId)
  - loadBooks(authorId)
  - toggleDescription()
  - toggleFavorite()
  - shareJadid()

**Локальное хранение избранного:**
- Использовать SharedPreferences для сохранения ID избранных джадидов

---

## МОДУЛЬ 4: Экраны Литературы

### 4.1 BooksFragment (Список литературы)
**Layout:** `fragment_books.xml` (готов)

**Функционал:**
- Загрузить все книги из Firebase
- Реализовать SearchView для поиска по названию и автору
- Реализовать фильтры (Spinner или ChipGroup):
  - По автору
  - По году публикации
  - По рейтингу
- Отобразить в вертикальном RecyclerView
- При клике → навигация к BookDetailFragment
- Обработка состояний: loading, success, error, empty

**ViewModel:**
- BooksViewModel с методами:
  - loadBooks()
  - searchBooks(query)
  - filterByAuthor(authorId)
  - sortBooks(sortType: SortType)

### 4.2 BookDetailFragment
**Layout:** `fragment_book_detail.xml` (готов)

**Функционал:**
- Получить ID книги из arguments
- Загрузить данные книги из Firebase
- Отобразить: обложку, название, автора, год, рейтинг, описание
- Имя автора должно быть кликабельным → навигация к JadidDetailFragment
- Кнопка "O'qishni boshlash" → навигация к BookReaderFragment
- Загрузить другие книги автора (исключая текущую)
- Отобразить в горизонтальном RecyclerView
- Реализовать Toolbar с кнопками: назад, избранное, скачать
- При открытии книги: увеличить rating в Firebase на 1
- Реализовать скачивание PDF файла (Download Manager)

**ViewModel:**
- BookDetailViewModel с методами:
  - loadBook(bookId)
  - loadOtherBooks(authorId, excludeBookId)
  - incrementRating(bookId)
  - toggleFavorite()
  - downloadBook()
  - startReading()

**Скачивание:**
- Запросить разрешение WRITE_EXTERNAL_STORAGE (для API < 29)
- Использовать DownloadManager для скачивания PDF
- Показать прогресс в Notification
- Сохранить в Downloads папку

### 4.3 BookReaderFragment
**Layout:** `fragment_book_reader.xml` (готов)

**Функционал:**
- Получить ID книги и PDF URL из arguments
- Загрузить PDF из Firebase Storage по URL
- Отобразить PDF используя библиотеку afreakyelf/Pdf-Viewer
- Реализовать навигацию по страницам:
  - Свайп влево/вправо
  - Кнопки "Предыдущая"/"Следующая"
  - SeekBar для быстрой навигации
- Отобразить текущую страницу / общее количество страниц
- Сохранять последнюю открытую страницу в SharedPreferences
- Восстанавливать позицию при повторном открытии
- Реализовать Toolbar с названием книги и кнопкой назад
- Поддержка zoom (pinch to zoom)
- Full screen режим (скрыть/показать controls по тапу)

**ViewModel:**
- BookReaderViewModel с методами:
  - loadPdfUrl(bookId)
  - saveCurrentPage(bookId, page)
  - loadLastPage(bookId): Int

---

## МОДУЛЬ 5: Экраны Тестов

### 5.1 TestsFragment (Список тестов)
**Layout:** `fragment_tests.xml` (готов)

**Функционал:**
- Загрузить все тесты из Firebase
- Отобразить в вертикальном RecyclerView
- Для каждого теста показать:
  - Название
  - Краткое описание
  - Количество вопросов
  - Ограничение по времени
  - Кнопку "Boshlash"
- При клике на кнопку → навигация к TestDetailFragment

**ViewModel:**
- TestsViewModel с методом loadTests()

### 5.2 TestDetailFragment (Прохождение теста)
**Layout:** `fragment_test_detail.xml` (готов)

**Функционал:**
- Получить ID теста из arguments
- Загрузить тест с вопросами из Firebase
- Отобразить первый вопрос
- Реализовать таймер обратного отсчета (CountDownTimer):
  - Формат: MM:SS
  - При достижении 00:00 → автоматическое завершение теста
- Отобразить прогресс (ProgressBar и текст "Savol X/Y")
- Для каждого вопроса:
  - Текст вопроса
  - 4 варианта ответа (RadioGroup)
- Кнопка "Oldingi" (Предыдущий):
  - Переход к предыдущему вопросу
  - Восстановление сохраненного ответа
  - Disabled на первом вопросе
- Кнопка "Keyingi" (Следующий):
  - Сохранение выбранного ответа
  - Переход к следующему вопросу
  - Валидация: нельзя перейти без выбора ответа
- Кнопка "Testni yakunlash" (Завершить тест):
  - Показывается только на последнем вопросе
  - Показать AlertDialog с подтверждением
  - При подтверждении → подсчет результатов → навигация к TestResultFragment
- Сохранять выбранные ответы в Map<questionId, answerIndex>

**ViewModel:**
- TestDetailViewModel с методами:
  - loadTest(testId)
  - nextQuestion()
  - previousQuestion()
  - saveAnswer(questionId, answerIndex)
  - finishTest(): TestResult
  - startTimer(totalTime)
  - getCurrentQuestion(): LiveData<Question>
  - getCurrentProgress(): LiveData<Int>
  - getTimeRemaining(): LiveData<Long>

### 5.3 TestResultFragment (Результаты теста)
**Layout:** `fragment_test_result.xml` (готов)

**Функционал:**
- Получить TestResult из arguments
- Отобразить:
  - Процент правильных ответов (большой шрифт)
  - "X из Y ответов правильные"
  - "Затраченное время: MM:SS"
- Загрузить правильные ответы из Firebase
- Отобразить детальный обзор в RecyclerView:
  - Номер вопроса
  - Текст вопроса
  - Правильный ответ (зеленый цвет)
  - Ваш ответ (если неправильно - красный цвет)
  - Иконка ✓ или ✗
- Сохранить результат в Firebase коллекцию test_results
- Кнопка "Пройти заново" → навигация к TestDetailFragment с тем же testId
- Кнопка "Вернуться к списку тестов" → навигация к TestsFragment

**ViewModel:**
- TestResultViewModel с методами:
  - loadTestResult(testId, userAnswers)
  - saveResult(testResult)
  - retakeTest()

---

## МОДУЛЬ 6: Дополнительные функции

### 6.1 Система избранного

**Реализация:**
- Использовать SharedPreferences для хранения:
  - Set<String> для ID избранных джадидов
  - Set<String> для ID избранных книг
- Ключи: "favorite_jadids", "favorite_books"

**Функции:**
- addToFavorites(itemId, type)
- removeFromFavorites(itemId, type)
- isFavorite(itemId, type): Boolean
- getFavorites(type): Set<String>

**UI:**
- Иконка сердца в Toolbar (outlined/filled)
- Анимация при добавлении/удалении
- Snackbar уведомление

### 6.2 Функция скачивания

**Требования:**
- Запросить разрешение для API < 29
- Использовать DownloadManager API
- Отобразить прогресс в Notification
- Сохранить в папку Downloads/Jadidlar
- После скачивания: показать Snackbar с кнопкой "Открыть"
- Открытие через Intent (PDF viewer)

**Обработка:**
- Проверка наличия интернета
- Проверка свободного места
- Обработка ошибок скачивания

### 6.3 Функция "Поделиться"

**Реализация:**
- Share Intent с текстом:
  - Для джадида: "Имя (годы жизни) - краткое описание"
  - Для книги: "Название - Автор - Год"
- Добавить ссылку на приложение в Play Store (если есть)

### 6.4 Глобальный поиск

**Функционал:**
- SearchView в Toolbar главного экрана
- Поиск по:
  - Именам джадидов
  - Названиям книг
  - Авторам книг
- Отображение результатов в отдельном фрагменте
- Группировка: "Джадиды", "Книги"
- При клике → навигация к соответствующему Detail экрану

---

## МОДУЛЬ 7: Оптимизация и производительность

### 7.1 Кэширование изображений
- Настроить Glide с DiskCacheStrategy.ALL
- Использовать placeholder изображения
- Обработка ошибок загрузки

### 7.2 Firebase офлайн persistence
- Включить Firestore offline persistence
- Установить неограниченный размер кэша

### 7.3 Пагинация (опционально)
- Использовать Paging 3 library для больших списков
- Загружать по 20 элементов

### 7.4 Оптимизация UI
- Skeleton screens при загрузке
- Smooth transitions между экранами
- Error states с кнопкой "Повторить"
- Empty states с понятными сообщениями

---

## МОДУЛЬ 8: Firebase Security Rules

### 8.1 Firestore Rules
- Коллекции jadids, books, tests: только чтение для всех
- Коллекция test_results: пользователь может создавать только свои результаты
- Все операции записи в jadids, books, tests: запрещены

### 8.2 Storage Rules
- Папки books/, images/: только чтение для всех
- Запись запрещена

---

## МОДУЛЬ 9: Аналитика

### 9.1 Firebase Analytics Events
Реализовать логирование событий:
- book_opened (book_id, book_title, author_id)
- reading_started (book_id)
- test_started (test_id)
- test_completed (test_id, score, time_spent)
- search_performed (search_query)
- added_to_favorites (item_type, item_id)
- book_downloaded (book_id)
- jadid_viewed (jadid_id)

### 9.2 Crashlytics
- Интегрировать Firebase Crashlytics
- Логировать non-fatal exceptions

---

## МОДУЛЬ 10: Локализация

### 10.1 Поддерживаемые языки
- Узбекский (uz) - основной
- Русский (ru) - дополнительный
- Английский (en) - fallback

### 10.2 Требования
- Все строки в strings.xml
- Создать strings.xml для каждого языка
- Контент из Firebase уже на узбекском
- Не использовать hardcoded строки

---

## МОДУЛЬ 11: Обработка ошибок

### 11.1 Network errors
- Проверка наличия интернета перед запросами
- Snackbar с кнопкой "Повторить"
- Использование кэшированных данных при отсутствии сети

### 11.2 Firebase errors
- Обработка всех типов ошибок (permission denied, not found, timeout)
- Понятные сообщения пользователю
- Логирование ошибок в Crashlytics

### 11.3 Validation errors
- Валидация форм (если есть)
- Проверка выбора ответа в тестах
- Предотвращение пустых запросов

---

## 5. Детальные требования к функционалу

### 5.1 Navigation flow
```
MainActivity (BottomNav)
├── MainFragment
│   ├── → JadidListFragment
│   │   └── → JadidDetailFragment
│   │       └── → BookDetailFragment
│   │           └── → BookReaderFragment
│   └── → BookDetailFragment
│       └── → BookReaderFragment
├── BooksFragment
│   └── → BookDetailFragment
│       └── → BookReaderFragment
└── TestsFragment
    └── → TestDetailFragment
        └── → TestResultFragment
```

### 5.2 Data flow
1. Repository получает данные из Firebase
2. Repository возвращает LiveData или Flow
3. ViewModel подписывается на данные
4. ViewModel предоставляет LiveData для Fragment
5. Fragment наблюдает за LiveData и обновляет UI

### 5.3 Lifecycle management
- Использовать viewLifecycleOwner для наблюдения за LiveData
- Отменять Coroutines в onCleared() ViewModel
- Освобождать ресурсы (таймеры, listeners) в onDestroyView()

---

## 6. Требования к UI/UX

### 6.1 Общие принципы
- Material Design 3 guidelines
- Минимум 48dp для touch targets
- Consistent spacing (8dp grid)
- Smooth transitions (300ms)

### 6.2 Loading states
- ProgressBar в центре экрана при первой загрузке
- Skeleton screens для списков (опционально)
- Shimmer effect (опционально)

### 6.3 Error states
- Иконка ошибки
- Понятное сообщение
- Кнопка "Повторить"

### 6.4 Empty states
- Иконка
- Сообщение "Нет данных"
- Подсказка что делать

### 6.5 Анимации
- Fade in для контента
- Slide transitions для навигации
- Ripple effect для кликов
- Expand/collapse для описаний

---

## 7. Технические требования

### 7.1 Dependencies (build.gradle)
Добавить все необходимые зависимости:
- Firebase BOM
- Firebase Firestore, Storage, Analytics, Crashlytics
- Navigation Component
- Lifecycle (ViewModel, LiveData)
- Kotlin Coroutines
- Glide
- PDF Viewer (afreakyelf)

### 7.2 Permissions (AndroidManifest.xml)
- INTERNET
- ACCESS_NETWORK_STATE
- WRITE_EXTERNAL_STORAGE (API < 29)

### 7.3 ProGuard rules
- Keep правила для Firebase
- Keep правила для data классы
- Keep правила для PDF Viewer

---

## 8. Критерии готовности

### 8.1 Обязательные функции
- ✅ Все экраны реализованы
- ✅ Навигация работает
- ✅ Загрузка данных из Firebase
- ✅ PDF Reader функционирует
- ✅ Тесты с таймером работают
- ✅ Результаты тестов сохраняются
- ✅ Избранное работает
- ✅ Скачивание PDF работает
- ✅ Рейтинг книг увеличивается
- ✅ Поиск работает
- ✅ Локализация (3 языка)
- ✅ Firebase Analytics интегрирована
- ✅ Crashlytics интегрирован
- ✅ Обработка всех ошибок
- ✅ Офлайн режим (кэширование)

### 8.2 Производительность
- ✅ Плавная прокрутка списков (60 FPS)
- ✅ Быстрая загрузка изображений
- ✅ Нет memory leaks
- ✅ Эффективное использование ресурсов

### 8.3 Code quality
- ✅ Следование MVVM архитектуре
- ✅ Разделение ответственности
- ✅ Комментарии для сложной логики
- ✅ Осмысленные имена переменных и функций
- ✅ DRY принцип (не повторяться)

---

## 9. Важные замечания

### 9.1 Приоритеты
1. Корректная работа всех функций
2. Обработка ошибок
3. Производительность
4. Code quality
5. Дополнительные улучшения

### 9.2 XML Layouts
- Все layouts уже написаны
- Использовать существующие ID
- Не изменять структуру layouts без необходимости
- Если нужно добавить элементы - добавлять аккуратно

### 9.3 Firebase
- Предполагается, что Firebase проект уже создан
- Конфигурационный файл google-services.json будет предоставлен
- Структура коллекций должна точно соответствовать ТЗ

### 9.4 Тестирование
- Тестировать на реальных устройствах
- Проверять все сценарии использования
- Тестировать offline режим
- Проверять разные языки

---

## 10. Порядок реализации

### Рекомендуемая последовательность:

1. **Настройка проекта**
   - Dependencies
   - Firebase
   - Navigation
   - Data models

2. **Базовая структура**
   - MainActivity с BottomNavigation
   - Создание всех Fragments (пустых)
   - Настройка Navigation Graph

3. **Главный экран**
   - MainFragment
   - Adapters
   - Repository для Jadids и Books
   - ViewModel

4. **Джадиды**
   - JadidListFragment
   - JadidDetailFragment
   - Избранное

5. **Литература**
   - BooksFragment (с поиском и фильтрами)
   - BookDetailFragment
   - BookReaderFragment
   - Скачивание

6. **Тесты**
   - TestsFragment
   - TestDetailFragment (с таймером)
   - TestResultFragment
   - Сохранение результатов

7. **Дополнительные функции**
   - Глобальный поиск
   - Share функционал
   - Улучшение избранного

8. **Полировка**
   - Analytics
   - Обработка ошибок
   - Локализация
   - Оптимизация
   - Тестирование

---

## 11. Контрольный список

Перед завершением проверить:

**Функционал:**
- [ ] Все экраны работают
- [ ] Навигация корректна
- [ ] Firebase загружает данные
- [ ] PDF открывается и читается
- [ ] Тесты работают с таймером
- [ ] Результаты сохраняются
- [ ] Избранное toggle работает
- [ ] Скачивание PDF работает
- [ ] Рейтинг увеличивается
- [ ] Поиск находит результаты
- [ ] Share работает

**Технические:**
- [ ] Нет crashes
- [ ] Нет memory leaks
- [ ] Обработаны все ошибки
- [ ] Loading states везде
- [ ] Empty states везде
- [ ] Офлайн кэш работает
- [ ] Analytics логирует события
- [ ] Локализация работает

**UI/UX:**
- [ ] Плавные анимации
- [ ] Быстрая прокрутка
- [ ] Responsive кнопки
- [ ] Понятные сообщения об ошибках

---

## Заключение

Данное техническое задание содержит всю необходимую информацию для разработки приложения "Jadidlar". Все XML layouts уже готовы, требуется только реализация логики, интеграция с Firebase и создание связующего кода между UI и данными. Следуйте модульной структуре и приоритезируйте корректную работу функционала над дополнительными улучшениями.